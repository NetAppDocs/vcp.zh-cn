---
sidebar: sidebar 
permalink: vcp_task_datastores_manage.html 
summary: 您可以使用此插件添加在 Element 卷上创建的管理数据存储库。 
keywords: netapp, datastore, vcp, vcenter, element 
---
= 管理数据存储库
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用适用于VMware vCenter Server的NetApp Element 插件、您可以管理由Element卷提供支持的数据存储库。您可以创建，扩展，克隆，共享或删除数据存储库。您还可以使用 VAAI UNMAP 允许集群从精简配置的 VMFS 数据存储库回收可用块空间。

.您需要的内容
* 要创建和管理数据存储库，必须先至少创建一个用户帐户。
* 要对数据存储库使用QoSSIOC服务、必须先从插件扩展点的QoSSIOC设置页面上配置设置。
+
** link:vcp_task_getstarted_5_0.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件5.0及更高版本配置设置"]
** link:vcp_task_getstarted.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件4.10及更早版本配置设置"]


* 由于数据存储库是使用选定 ESXi 主机支持的最高 VMFS 版本创建的，因此所有集群成员都应运行相同版本的 vSphere 和 ESXi ，以避免出现 VMFS 兼容性问题。


.选项
* <<创建数据存储库>>
* <<查看数据存储库列表>>
* <<扩展数据存储库>>
* <<克隆数据存储库>>
* <<共享数据存储库>>
* <<执行 VAAI UNMAP>>
* <<删除数据存储库>>



TIP: 在 vSphere 中使用任务监控功能监控数据存储库操作的完成情况。



== 创建数据存储库

您可以从插件扩展创建数据存储库。

.您需要的内容
* 必须至少将一台主机连接到 vCenter Server 。
* 必须至少添加并运行一个集群。
+

NOTE: 如果您使用的是 vCenter 链接模式，请确保已使用正确的 vCenter Server 添加集群。

* 必须至少创建一个用户帐户。
* 要对数据存储库使用QoSSIOC服务、您必须先从插件扩展点的"QoSSIOC Settings"页面上配置设置：
+
** link:vcp_task_getstarted_5_0.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件5.0及更高版本配置设置"]
** link:vcp_task_getstarted.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件4.10及更早版本配置设置"]




.步骤
. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要用于此任务的集群。

. 从数据存储库页面中，选择 * 创建数据存储库 * 。
. 输入数据存储库的名称。
+

TIP: 为数据中心中的每个数据存储库使用唯一的名称。对于多个集群或 vCenter Server 环境，请使用描述性命名最佳实践。

. 选择 * 下一步 * 。
. 为数据存储库选择一个或多个所需主机。
+

NOTE: 在创建新数据存储库之前，您至少需要一个已连接的主机。如果主机具有多个启动程序，请选择一个启动程序或主机以选择所有启动程序。如果您使用的是 vCenter 链接模式，则只能选择可供分配了集群的 vCenter Server 使用的主机。

. 选择 * 下一步 * 。
. 在*配置卷*窗格中，选择现有卷或为新数据存储库创建新卷：
+
[role="tabbed-block"]
====
.选择现有卷
--
如果选择现有卷、则必须满足以下前提条件：

** 要使用卷访问组、请执行以下操作：
+
... 创建启用了512e的新卷。
... 将卷添加到包含一个或多个目标主机启动程序的访问组。


** 要使用CHAP、请执行以下操作：
+
... 确保已为每个目标主机iSCSI适配器配置CHAP。
... 使用以下选项之一创建启用了512e的新卷：
+
**** 请使用一个帐户、并为每个目标主机设置适当的CHAP设置。
**** 创建帐户并配置目标和启动程序密钥。


... 查看卷详细信息。
... 将卷IQN添加到每个目标主机iSCSI适配器静态发现表。




--
.创建新卷
--
.. 为支持数据存储库的卷输入一个名称。
.. 从帐户列表中选择一个用户帐户。
.. 输入要创建的卷的总大小。
+

NOTE: 默认卷大小选择以 GB 为单位。您可以使用以 GB 或 GiB 为单位的大小创建卷： 1GB = 1 000 000 000 字节 1 GiB = 1 073 741 824 字节

+
默认情况下，所有新卷的 512 字节模拟均设置为 on 。

.. 在 * 服务质量 * 区域中，执行以下操作之一：
+
... 在 * 策略 * 下，选择现有 QoS 策略。
... 在 * 自定义设置 * 下，为 IOPS 设置自定义的最小值，最大值和突发值，或者使用默认 QoS 值。
+

TIP: QoS 策略最适合服务环境，例如数据库，应用程序或基础架构服务器，这些服务器很少重新启动，需要对存储的持续等量访问。自定义 QoSSIOC 自动化最适合日常或每天多次可能重新启动，启动或关闭的轻型 VM ，例如虚拟桌面或专业的自助式 VM 。不应同时使用 QoSSIOC 自动化和 QoS 策略。

+

TIP: 最大或突发 IOPS 值大于 20 ， 000 IOPS 的卷可能需要较高的队列深度或多个会话，才能在单个卷上实现此级别的 IOPS 。





--
====
. 选择 * 下一步 * 。
. 通过选择以下选项之一配置主机访问的授权类型：
+
** * 使用卷访问组 * ：选择此选项可明确限制哪些启动程序可以查看卷。
** * 使用 CHAP* ：选择此选项可实现基于密钥的安全访问，而不限制启动程序。


. 选择 * 下一步 * 。
. 如果选择了 * 使用卷访问组 * ，请为选定主机配置卷访问组。
+
在 * 选定启动程序所需 * 中列出的卷访问组已与您在先前步骤中选择的一个或多个主机启动程序关联

+
.. 选择其他卷访问组或创建新的卷访问组以与可用启动程序关联：
+
*** * 可用 * ：集群中的其他卷访问组选项。
*** * 创建新访问组 * ：输入新访问组的名称并选择 * 添加 * 。


.. 选择 * 下一步 * 。
.. 在 * 配置主机的访问 * 窗格中，将可用的主机启动程序（ IQN 或 WWPN ）与您在上一窗格中选择的卷访问组相关联。如果某个主机启动程序已与某个卷访问组关联，则此字段对于该启动程序为只读字段。如果主机启动程序没有卷访问组关联，请从启动程序旁边的列表中选择一个选项。
.. 选择 * 下一步 * 。


. 如果要启用 QoSSIOC 自动化，请选中 * 启用 QoS 和 SIOC* ，然后配置 QoSSIOC 设置。
+
--

TIP: 如果您使用的是 QoS 策略，请勿启用 QoSSIOC 。QoSSIOC 将覆盖和调整卷 QoS 设置的 QoS 值。

如果QoSSIOC服务不可用、则必须先配置QoSSIOC设置：

** link:vcp_task_getstarted_5_0.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件5.0及更高版本配置设置"]
** link:vcp_task_getstarted.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件4.10及更早版本配置设置"]


--
+
.. 选择 * 启用 QoS 和 SIOC* 。
.. 配置 * 突发因子 * 。
+

NOTE: 突发因子是 VMDK 的 IOPS 限制（ SIOC ）设置的倍数。如果更改默认值，请确保使用的突发因子值在与任何 VMDK 的 IOPS 限制相乘后不会超过 Element 卷的最大突发限制。

.. （可选）选择 * 覆盖默认 QoS" 并配置设置。
+

NOTE: 如果数据存储库禁用了覆盖默认 QoS 设置，则会根据每个虚拟机的默认 SIOC 设置自动设置共享和限制 IOPS 值。

+

TIP: 在未自定义 SIOC IOPS 限制的情况下，请勿自定义 SIOC 共享限制。

+

TIP: 默认情况下，最大 SIOC 磁盘共享设置为 `无限制` 。在 VDI 等大型 VM 环境中，这可能会导致集群上的最大 IOPS 过量使用。启用 QoSSIOC 后，请始终选中 Override Default QoS 并将 Limit IOPS 选项设置为合理值。



. 选择 * 下一步 * 。
. 确认选择并单击 * 完成 * 。
. 要查看任务的进度，请使用 vSphere 中的任务监控。如果数据存储库未显示在列表中，请刷新视图。




== 查看数据存储库列表

您可以从插件扩展点的"Datastores"页面查看可用的数据存储库。

. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请在导航栏中选择要使用的集群。

. 查看数据存储库列表。
+

NOTE: 不会列出跨多个卷的数据存储库（混合数据存储库）。数据存储库视图仅显示选定 NetApp Element 集群中的 ESXi 主机上可用的数据存储库。

. 查看以下信息：
+
** * 名称 * ：分配给数据存储库的名称。
** * 主机名 * ：每个关联主机设备的地址。
** * 状态 * ：可能值 `可访问` 或 `不可访问` 表示数据存储库当前是否已连接到 vSphere 。
** * 类型 * ： VMware 文件系统数据存储库类型。
** * 卷名称 * ：分配给关联卷的名称。
** * 卷 NAA* ： NAA IEEE 注册扩展格式的关联卷的全局唯一 SCSI 设备标识符。
** * 总容量（ GB ） * ：数据存储库的总格式化容量。
** * 可用容量（ GB ） * ：可用于数据存储库的空间。
** * QoSSIOC Automation" ：指示是否已启用 QoSSIOC 自动化。可能值：
+
*** `Enabled` ：已启用 QoSSIOC 。
*** `d已标记` ：未启用 QoSSIOC 。
*** `max exceeded` ：卷最大 QoS 已超过指定的限制值。








== 扩展数据存储库

您可以使用插件扩展点扩展数据存储库以增加卷大小。扩展数据存储库还会扩展与该数据存储库相关的 VMFS 卷。

.步骤
. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请在导航栏中选择要使用的集群。

. 在 Datastores 页面中，选中要扩展的数据存储库对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 扩展 * 。
. 在 New Datastore Size 字段中，输入新数据存储库所需的大小，然后选择 GB 或 GiB 。
+

NOTE: 扩展数据存储库将占用整个卷的大小。新数据存储库大小不能超过选定集群上的未配置空间或集群允许的最大卷大小。

. 选择 * 确定 * 。
. 刷新页面




== 克隆数据存储库

您可以使用此插件克隆数据存储库，其中包括将新数据存储库挂载到所需的 ESXi 服务器或集群。您可以为数据存储库克隆命名并配置其 QoSSIOC ，卷，主机和授权类型设置。

如果源数据存储库上存在虚拟机，则克隆数据存储库上的虚拟机将使用新名称进入清单。

克隆数据存储库的卷大小与支持源数据存储库的卷大小匹配。默认情况下，所有新卷的 512 字节模拟均设置为 on 。

.您需要的内容
* 必须至少将一台主机连接到 vCenter Server 。
* 必须至少添加并运行一个集群。
+

NOTE: 如果您使用的是 vCenter 链接模式，请确保已使用正确的 vCenter Server 添加集群。

* 可用的未配置空间必须等于或大于源卷大小。
* 必须至少创建一个用户帐户。


.步骤
. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请在导航栏中选择要使用的集群。

. 从 * 数据存储库 * 页面中，选中要克隆的数据存储库对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 克隆 * 。
+

NOTE: 如果您尝试克隆的数据存储库包含连接的磁盘不位于选定数据存储库上的虚拟机，则克隆数据存储库上的虚拟机副本不会添加到虚拟机清单中。

. 输入数据存储库名称。
+

TIP: 为数据中心中的每个数据存储库使用唯一的名称。对于多个集群或 vCenter Server 环境，请使用描述性命名最佳实践。

. 选择 * 下一步 * 。
. 为数据存储库选择一个或多个所需主机。
+

NOTE: 在创建新数据存储库之前，您至少需要一个已连接的主机。如果主机具有多个启动程序，请选择一个启动程序或主机以选择所有启动程序。如果您使用的是 vCenter 链接模式，则只能选择可供分配了集群的 vCenter Server 使用的主机。

. 选择 * 下一步 * 。
. 在 * 配置卷 * 窗格中，执行以下操作：
+
.. 为支持克隆数据存储库的新 NetApp Element 卷输入一个名称。
.. 从帐户列表中选择一个用户帐户。
+

NOTE: 在创建卷之前，您至少需要一个现有用户帐户。

.. 在 * 服务质量 * 区域中，执行以下操作之一：
+
*** 在 * 策略 * 下，选择现有 QoS 策略（如果可用）。
*** 在 * 自定义设置 * 下，为 IOPS 设置自定义的最小值，最大值和突发值，或者使用默认 QoS 值。
+

TIP: QoS 策略最适合服务环境，例如数据库，应用程序或基础架构服务器，这些服务器很少重新启动，需要对存储的持续等量访问。自定义 QoSSIOC 自动化最适合日常或每天多次可能重新启动，启动或关闭的轻型 VM ，例如虚拟桌面或专业的自助式 VM 。不应同时使用 QoSSIOC 自动化和 QoS 策略。

+

TIP: 最大或突发 IOPS 值大于 20 ， 000 IOPS 的卷可能需要较高的队列深度或多个会话，才能在单个卷上实现此级别的 IOPS 。





. 选择 * 下一步 * 。
. 通过选择以下选项之一配置主机访问的授权类型：
+
** * 使用卷访问组 * ：选择此选项可明确限制哪些启动程序可以查看卷。
** * 使用 CHAP* ：选择此选项可实现基于密钥的安全访问，而不限制启动程序。


. 选择 * 下一步 * 。
. 如果选择了 * 使用卷访问组 * ，请为选定主机配置卷访问组。
+
在 * 选定启动程序所需 * 中列出的卷访问组已与您在先前步骤中选择的一个或多个主机启动程序关联。

+
.. 选择其他卷访问组或创建新的卷访问组以与可用启动程序关联：
+
*** * 可用 * ：集群中的其他卷访问组选项。
*** * 创建新访问组 * ：输入新访问组的名称，然后单击 * 添加 * 。


.. 选择 * 下一步 * 。
.. 在 * 配置主机的访问 * 窗格中，将可用的主机启动程序（ IQN 或 WWPN ）与您在上一窗格中选择的卷访问组相关联。
+
如果某个主机启动程序已与某个卷访问组关联，则此字段对于该启动程序为只读字段。如果主机启动程序没有卷访问组关联，请从启动程序旁边的下拉列表中选择一个选项。

.. 选择 * 下一步 * 。


. 如果要启用 QoSSIOC 自动化，请选中 * 启用 QoS 和 SIOC* 复选框，然后配置 QoSSIOC 设置。
+
--

IMPORTANT: 如果您使用的是 QoS 策略，请勿启用 QoSSIOC 。QoSSIOC 将覆盖和调整卷 QoS 设置的 QoS 值。

如果QoSSIOC服务不可用、则必须先从插件扩展点的"QoSSIOC Settings"页面上配置设置：

** link:vcp_task_getstarted_5_0.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件5.0及更高版本配置设置"]
** link:vcp_task_getstarted.html#configure-qossioc-settings-using-the-plug-in["使用Element vCenter插件4.10及更早版本配置设置"]


--
+
.. 选择 * 启用 QoS 和 SIOC* 。
.. 配置 * 突发因子 * 。
+

NOTE: 突发因子是 VMDK 的 IOPS 限制（ SIOC ）设置的倍数。如果更改默认值，请确保使用的突发因子值在与任何 VMDK 的 IOPS 限制相乘后不会超过 NetApp Element 卷的最大突发限制。

.. * 可选 * ：选择 * 覆盖默认 QoS" 并配置设置。
+
如果数据存储库禁用了覆盖默认 QoS 设置，则会根据每个虚拟机的默认 SIOC 设置自动设置共享和限制 IOPS 值。

+

TIP: 在未自定义 SIOC IOPS 限制的情况下，请勿自定义 SIOC 共享限制。

+

TIP: 默认情况下，最大 SIOC 磁盘共享设置为 `无限制` 。在 VDI 等大型 VM 环境中，这可能会导致集群上的最大 IOPS 过量使用。启用 QoSSIOC 后，请始终选中 Override Default QoS 并将 Limit IOPS 选项设置为合理值。



. 选择 * 下一步 * 。
. 确认选择并选择 * 完成 * 。
. 刷新页面




== 共享数据存储库

您可以使用插件扩展点与一个或多个主机共享数据存储库。

数据存储库只能在同一数据中心内的主机之间共享。

.您需要的内容
* 必须至少添加并运行一个集群。
+

NOTE: 如果您使用的是 vCenter 链接模式，请确保已使用正确的 vCenter Server 添加集群。

* 选定数据中心下必须有多个主机。


.步骤
. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请在导航栏中选择要使用的集群。

. 从 * 数据存储库 * 页面中，选中要共享的数据存储库对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 共享 * 。
. 通过选择以下选项之一配置主机访问的授权类型：
+
** * 使用卷访问组 * ：选择此选项可明确限制哪些启动程序可以查看卷。
** * 使用 CHAP* ：选择此选项可实现基于密钥的安全访问，而不对启动程序进行限制。


. 选择 * 下一步 * 。
. 为数据存储库选择一个或多个所需主机。
+

NOTE: 在创建新数据存储库之前，您至少需要一个已连接的主机。如果主机具有多个启动程序，请通过选择主机来选择一个启动程序或所有启动程序。如果您使用的是 vCenter 链接模式，则只能选择可供分配了集群的 vCenter Server 使用的主机。

. 选择 * 下一步 * 。
. 如果选择了使用 * 卷访问组 * ，请为选定主机配置卷访问组。
+
在 * 选定启动程序所需 * 中列出的卷访问组已与您在先前步骤中选择的一个或多个主机启动程序关联。

+
.. 选择其他卷访问组或创建新的卷访问组以与可用启动程序关联：
+
*** * 可用 * ：集群中的其他卷访问组选项。
*** * 创建新访问组 * ：输入新访问组的名称，然后单击 * 添加 * 。


.. 选择 * 下一步 * 。
.. 在 * 配置主机的访问 * 窗格中，将可用的主机启动程序（ IQN 或 WWPN ）与您在上一窗格中选择的卷访问组相关联。
+
如果某个主机启动程序已与某个卷访问组关联，则此字段对于该启动程序为只读字段。如果主机启动程序没有卷访问组关联，请从启动程序旁边的下拉列表中选择一个选项。



. 确认选择并选择 * 完成 * 。
. 刷新页面




== 执行 VAAI UNMAP

如果您希望集群从精简配置的 VMFS5 数据存储库回收释放的块空间，请使用 VAAI UNMAP 功能。

.您需要的内容
* 确保用于此任务的数据存储库为 VMFS5 或更早版本。VMFS6 无法使用 VAAI UNMAP ，因为 ESXi 会自动执行此任务
* 确保已为 VAAI UNMAP 启用 ESXi 主机系统设置：
+
`esxcli system settings advanced list -o/VMFS3/EnableBlockDelete`

+
要启用，必须将整数值设置为 1 。

* 如果未为 VAAI UNMAP 启用 ESXi 主机系统设置，请使用以下命令将整数值设置为 1 ：
+
`esxcli system settings advanced set -i 1 -o /VMFS3/EnableBlockDelete`



.步骤
. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请在导航栏中选择要使用的集群。

. 从 * 数据存储库 * 页面中，选中要使用 VAAI UNMAP 的数据存储库对应的复选框。
. 在显示的菜单中，选择 * 操作 * 。
. 选择 * VAAI 取消映射 * 。
. 按名称或 IP 地址选择主机。
. 输入主机用户名和密码。
. 确认选择并选择 * 确定 * 。




== 删除数据存储库

您可以使用插件扩展点删除数据存储库。此操作将永久删除与要删除的数据存储库上的 VM 关联的所有文件。此插件不会删除包含已注册 VM 的数据存储库。

. 在vSphere Web Client中、打开*管理*选项卡：
+
** 从Element vCenter插件5.0开始、选择* NetApp Element 远程插件>管理>管理*。
** 对于Element vCenter插件4.10及更早版本、请选择* NetApp Element 管理>管理*。


+

NOTE: 如果添加了两个或更多集群，请在导航栏中选择要使用的集群。

. 从 * 数据存储库 * 页面中，选中要删除的数据存储库对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 删除 * 。
. （可选）如果要删除与数据存储库关联的 NetApp Element 卷，请选中 * 删除关联卷 * 复选框。
+

NOTE: 您也可以选择保留卷，然后将其与其他数据存储库相关联。

. 选择 * 是 * 。




== 了解更多信息

* https://docs.netapp.com/us-en/hci/index.html["NetApp HCI 文档"^]
* https://www.netapp.com/data-storage/solidfire/documentation["SolidFire 和 Element 资源页面"^]

