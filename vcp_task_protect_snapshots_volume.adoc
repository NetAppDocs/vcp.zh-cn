---
sidebar: sidebar 
permalink: vcp_task_protect_snapshots_volume.html 
summary: 您可以确保创建数据副本，并将其存储在所需位置。 
keywords: netapp, hci, vcp, vcenter, element, protect, snapshots, clone, backup, amazon, s3, openstack, swift 
---
= 在 vCenter Server 中创建和管理卷快照
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
创建 https://docs.netapp.com/us-en/hci/docs/concept_hci_dataprotection.html#volume-snapshots-for-data-protection["卷快照"] 创建卷的时间点副本。此过程只需少量系统资源和空间，因此创建快照的速度比克隆快。

您可以使用快照将卷回滚到创建快照时的状态。但是，由于快照只是卷元数据的副本，因此无法挂载或写入这些副本。

.选项
* <<Create a volume snapshot>>
* <<View volume snapshot details>>
* <<Clone a volume from a snapshot>>
* <<Roll back a volume to a snapshot>>
* <<Back up a volume snapshot to an external object store>>
* <<Delete a volume snapshot>>




== 创建卷快照

您可以为活动卷创建快照，以便在任意时间点保留卷映像。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Management* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 卷 * 子选项卡。
. 在 * 活动 * 视图中，选中要用于快照的卷对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 创建 Snapshot* 。
. （可选）：在 Create Snapshot 对话框中，输入快照的名称。
+

TIP: 使用描述性命名最佳实践。如果您的环境中使用了多个集群或 vCenter Server ，这一点尤其重要。如果不输入名称，系统将使用创建快照的日期和时间创建快照默认名称。

. （可选）选中 * 配对时将快照包括在复制中 * 复选框，以确保在配对父卷时复制快照。
. 选择以下选项之一作为快照的保留期限：
+
** * 永久保留 * ：在系统上无限期保留快照。
** * 设置保留期限 * ：确定系统保留快照的时间长度（天，小时或分钟）。
+

NOTE: 设置保留期限时，您可以选择从当前时间开始的期限。（保留时间不会从快照创建时间开始计算。）



. 要创建一个即时快照，请选择 * 立即创建快照 * 。
. 要计划在未来某个时间运行快照，请完成以下步骤：
+
.. 选择 * 创建快照计划 * 。
.. 输入计划名称。
.. 选择计划类型并配置计划详细信息。
.. （可选）选中 * 重复计划 * 复选框以定期重复计划的快照。


. 选择 * 确定 * 。




== 查看卷快照详细信息

您可能需要验证是否已添加快照。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 快照 * 子选项卡。
. （可选）选择以下筛选器之一：
+
** * 单个 * ：不是组快照成员的卷快照。
** * 成员 * ：属于组快照的卷快照。
** * 非活动 * ：从已删除但尚未清除的卷创建的卷快照。


. 查看快照详细信息。




== 从快照克隆卷

您可以从卷的快照创建新卷。执行此操作时，系统会使用创建快照时卷上包含的数据使用快照信息克隆新卷。此过程还会在新创建的卷中存储有关卷的其他快照的信息。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 快照 * 子选项卡。
. 从两个视图中选择一个：
+
** * 单个 * ：列出不属于组快照的卷快照。
** * 成员 * ：列出属于组快照的卷快照。


. 选中要克隆为卷的卷快照对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 从 Snapshot 克隆卷 * 。
. 输入卷名称和总大小，然后为新卷选择 GB 或 GiB 。
. 选择卷的访问类型：
+
** * 只读 * ：仅允许执行读取操作。
** * 读 / 写 * ：允许执行读取和写入操作。
** * 已锁定 * ：不允许执行任何读取或写入操作。
** * 复制目标 * ：指定为复制的卷对中的目标卷。


. 选择要与新卷关联的用户帐户。
. 选择 * 确定 * 。
. 验证新卷：
+
.. 选择 * NetApp Element Management* > * Management* 。
.. 选择 * 卷 * 子选项卡。
.. 在 * 活动 * 视图中，确认新卷已列出。
+

TIP: 如果需要，请刷新页面。







== 将卷回滚到快照

您可以随时将卷回滚到快照。此操作将撤消自创建快照以来对卷所做的任何更改。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 快照 * 子选项卡。
. 从两个视图中选择一个：
+
** * 单个 * ：列出不属于组快照的卷快照。
** * 成员 * ：列出属于组快照的卷快照。


. 选中要用于卷回滚的卷快照对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 将卷回滚到 Snapshot* 。
. （可选）要在回滚到快照之前保存卷的当前状态，请执行以下操作：
+
.. 在 Rollback to Snapshot 对话框中，选择 * 将卷的当前状态另存为快照 * 。
.. 输入新快照的名称。


. 选择 * 确定 * 。




== 将卷快照备份到外部对象存储

您可以使用集成备份功能备份卷快照。您可以将快照从运行 NetApp Element 软件的集群备份到外部对象存储或另一个基于 Element 的集群。

将快照备份到外部对象存储时，必须与允许读 / 写操作的对象存储建立连接。

* <<Back up a volume snapshot to an Amazon S3 object store>>
* <<Back up a volume snapshot to an OpenStack Swift object store>>
* <<Back up a volume snapshot to a cluster running Element software>>




=== 将卷快照备份到 Amazon S3 对象存储

您可以将 NetApp Element 快照备份到与 Amazon S3 兼容的外部对象存储。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 快照 * 子选项卡。
. 选中要备份的卷快照对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 备份至 * 。
. 在 * 将卷备份到 * 下的对话框中，选择 * Amazon S3* 。
. 在 * 使用以下数据格式 * 下选择一个选项：
+
** * 原生 * ：只有基于 NetApp Element 软件的存储系统才能读取的压缩格式。
** * 未压缩 * ：与其他系统兼容的未压缩格式。


. 输入详细信息：
+
** * 主机名 * ：输入用于访问对象存储的主机名。
** * 访问密钥 ID* ：输入帐户的访问密钥 ID 。
** * 机密访问密钥 * ：输入帐户的机密访问密钥。
** * Amazon S3 Bucket* ：输入用于存储备份的 S3 存储分段。
** * 前缀 * ：（可选）输入备份名称的前缀。
** * 名称标记 * ：（可选）输入要附加到前缀的名称标记。


. 选择 * 确定 * 。




=== 将卷快照备份到 OpenStack Swift 对象存储

您可以将 NetApp Element 快照备份到与 OpenStack Swift 兼容的二级对象存储。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 快照 * 子选项卡。
. 选中要备份的卷快照对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 备份至 * 。
. 在 * 将卷备份到 * 下的对话框中，选择 * OpenStack Swift* 。
. 在 * 使用以下数据格式 * 下选择一个选项：
+
** * 原生 * ：只有基于 NetApp Element 软件的存储系统才能读取的压缩格式。
** * 未压缩 * ：与其他系统兼容的未压缩格式。


. 输入详细信息：
+
** * URL * ：输入用于访问对象存储的 URL 。
** * 用户名 * ：输入帐户的用户名。
** * 身份验证密钥 * ：输入帐户的身份验证密钥。
** * 容器 * ：输入用于存储备份的容器。
** * 前缀 * ：（可选）输入备份卷名称的前缀。
** * 名称标记 * ：（可选）输入要附加到前缀的名称标记。


. 选择 * 确定 * 。




=== 将卷快照备份到运行 Element 软件的集群

您可以将运行 NetApp Element 软件的集群上的卷快照备份到远程 Element 集群。

您必须在目标集群上创建一个大小等于或大于要用于备份的快照的卷。

在将一个集群备份或还原到另一个集群时，系统会生成一个密钥，用作集群之间的身份验证。此批量卷写入密钥可使源集群向目标集群进行身份验证，从而在向目标卷写入数据时提供安全性。在备份或还原过程中，您需要先从目标卷生成批量卷写入密钥，然后再开始此操作。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Management* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 选择 * 卷 * 子选项卡。
. 选中目标卷对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 从 * 还原。
. 在对话框的 * 还原自 * 下，选择 * NetApp Element * 。
. 在 * 使用以下数据格式 * 下选择一个选项：
+
** * 原生 * ：只有基于 NetApp Element 软件的存储系统才能读取的压缩格式。
** * 未压缩 * ：与其他系统兼容的未压缩格式。


. 选择 * 生成密钥 * 可为目标卷生成批量卷写入密钥。
. 将批量卷写入密钥复制到剪贴板，以应用于源集群上的后续步骤。
. 从包含源集群的 vCenter 中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要用于此任务的集群。

. 选中要用于备份的快照对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 备份至 * 。
. 在对话框的 * 将卷备份到 * 下，选择 * NetApp Element * 。
. 在 * 采用以下数据格式 * 下选择与目标集群相同的选项。
. 输入详细信息：
+
** * 远程集群 MVIP* ：输入目标卷集群的管理虚拟 IP 地址。
** * 远程集群用户密码 * ：输入远程集群用户名。
** * 远程用户密码 * ：输入远程集群密码。
** * 批量卷写入密钥 * ：粘贴先前在目标集群上生成的密钥。


. 选择 * 确定 * 。




== 删除卷快照

您可以使用 NetApp Element 管理扩展点从运行 NetApp Element 软件的集群中删除卷快照。删除快照时，系统会立即将其删除。

您可以删除正在从源集群复制的快照。如果删除快照时快照正在同步到目标集群，则同步复制将完成，快照将从源集群中删除。快照不会从目标集群中删除。

您还可以从目标集群中删除已复制到目标的快照。已删除的快照将保留在目标上已删除的快照列表中，直到系统检测到您已删除源集群上的快照为止。在目标检测到您已删除源快照后，目标将停止复制该快照。

.步骤
. 从 vCenter 插件中，选择 * NetApp Element Management* > * Protection* 。
+

NOTE: 如果添加了两个或更多集群，请确保在导航栏中选择要使用的集群。

. 从 * 快照 * 子选项卡中，选择以下视图之一：
+
** * 单个 * ：不属于组快照的卷快照列表。
** * 非活动 * ：从已删除但尚未清除的卷创建的卷快照列表。


. 选中要删除的卷快照对应的复选框。
. 选择 * 操作 * 。
. 在显示的菜单中，选择 * 删除 * 。
. 确认操作。


[discrete]
== 了解更多信息

* https://docs.netapp.com/us-en/hci/index.html["NetApp HCI 文档"^]
* https://www.netapp.com/data-storage/solidfire/documentation["SolidFire 和 Element 资源页面"^]

